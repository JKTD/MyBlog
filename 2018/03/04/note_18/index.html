<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.54.0" />



<link rel="canonical" href="http://blog.flywithme.top/2018/03/04/note_18/">


    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <title>Go: 10-1 channel - Fly With Bug</title>
    
<meta name="description" content="channel的用法  channel buffered channel range 理论基础：Communication Sequential Process(CSP) Don&amp;rsquo;t communicate by sharing memory;share memory by communicating(不要通过共享内存来通信， 通过通信来共享内存)  package main import ( &amp;quot;fmt&amp;quot; &amp;quot;time&amp;quot; ) func worker(id int, c chan int) { for n := range c { fmt.Printf(&amp;quot;Worker %d received %c\n&amp;quot;, id, n) } } func createWorker(id int) chan&amp;lt;- int { c := make(chan int) go worker(id, c) return c } func chanDemo() { var channels [10]chan&amp;lt;- int for i := 0; i &amp;lt; 10; i&#43;&#43; { channels[i] = createWorker(i) } for i := 0; i &amp;lt; 10; i&#43;&#43; { channels[i] &amp;lt;- &#39;a&#39; &#43; i } for i := 0; i &amp;lt; 10; i&#43;&#43; { channels[i] &amp;lt;- &#39;A&#39; &#43; i } time.">

<meta property="og:title" content="Go: 10-1 channel - Fly With Bug">
<meta property="og:type" content="article">
<meta property="og:url" content="http://blog.flywithme.top/2018/03/04/note_18/">
<meta property="og:image" content="http://blog.flywithme.topimages/default.png">
<meta property="og:site_name" content="Fly With Bug">
<meta property="og:description" content="channel的用法  channel buffered channel range 理论基础：Communication Sequential Process(CSP) Don&amp;rsquo;t communicate by sharing memory;share memory by communicating(不要通过共享内存来通信， 通过通信来共享内存)  package main import ( &amp;quot;fmt&amp;quot; &amp;quot;time&amp;quot; ) func worker(id int, c chan int) { for n := range c { fmt.Printf(&amp;quot;Worker %d received %c\n&amp;quot;, id, n) } } func createWorker(id int) chan&amp;lt;- int { c := make(chan int) go worker(id, c) return c } func chanDemo() { var channels [10]chan&amp;lt;- int for i := 0; i &amp;lt; 10; i&#43;&#43; { channels[i] = createWorker(i) } for i := 0; i &amp;lt; 10; i&#43;&#43; { channels[i] &amp;lt;- &#39;a&#39; &#43; i } for i := 0; i &amp;lt; 10; i&#43;&#43; { channels[i] &amp;lt;- &#39;A&#39; &#43; i } time.">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="Fly With Bug">
<meta name="twitter:url" content="http://blog.flywithme.top/2018/03/04/note_18/">
<meta name="twitter:title" content="Go: 10-1 channel - Fly With Bug">
<meta name="twitter:description" content="channel的用法  channel buffered channel range 理论基础：Communication Sequential Process(CSP) Don&amp;rsquo;t communicate by sharing memory;share memory by communicating(不要通过共享内存来通信， 通过通信来共享内存)  package main import ( &amp;quot;fmt&amp;quot; &amp;quot;time&amp;quot; ) func worker(id int, c chan int) { for n := range c { fmt.Printf(&amp;quot;Worker %d received %c\n&amp;quot;, id, n) } } func createWorker(id int) chan&amp;lt;- int { c := make(chan int) go worker(id, c) return c } func chanDemo() { var channels [10]chan&amp;lt;- int for i := 0; i &amp;lt; 10; i&#43;&#43; { channels[i] = createWorker(i) } for i := 0; i &amp;lt; 10; i&#43;&#43; { channels[i] &amp;lt;- &#39;a&#39; &#43; i } for i := 0; i &amp;lt; 10; i&#43;&#43; { channels[i] &amp;lt;- &#39;A&#39; &#43; i } time.">
<meta name="twitter:image" content="http://blog.flywithme.topimages/default.png">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"http://blog.flywithme.top"
    },
    "headline": "Go: 10-1 channel - Fly With Bug",
    "image": {
      "@type": "ImageObject",
      "url": "http://blog.flywithme.topimages/default.png",
      "height": 800,
      "width": 800
    },
    "datePublished": "2018-03-04T19:59:50JST",
    "dateModified": "2018-03-04T19:59:50JST",
    "author": {
      "@type": "Person",
      "name": "Fly With Bug"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Fly With Bug",
      "logo": {
        "@type": "ImageObject",
        "url": "http://blog.flywithme.topimages/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "channel的用法  channel buffered channel range 理论基础：Communication Sequential Process(CSP) Don&rsquo;t communicate by sharing memory;share memory by communicating(不要通过共享内存来通信， 通过通信来共享内存)  package main import ( &quot;fmt&quot; &quot;time&quot; ) func worker(id int, c chan int) { for n := range c { fmt.Printf(&quot;Worker %d received %c\n&quot;, id, n) } } func createWorker(id int) chan&lt;- int { c := make(chan int) go worker(id, c) return c } func chanDemo() { var channels [10]chan&lt;- int for i := 0; i &lt; 10; i++ { channels[i] = createWorker(i) } for i := 0; i &lt; 10; i++ { channels[i] &lt;- 'a' + i } for i := 0; i &lt; 10; i++ { channels[i] &lt;- 'A' + i } time."
  }
</script>


    <link href="http://blog.flywithme.topcss/styles.css" rel="stylesheet">
    

  </head>

  <body>
    
    
    

    <header class="l-header">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://blog.flywithme.top">Fly With Bug</a>
          </div>

          

        </div>
      </nav>
    </header>

    <main>
      <div class="container">
        
<div class="row">
  <div class="col-md-8">

    <nav class="p-crumb">
      <ol class="breadcrumb">
        <li><a href="http://blog.flywithme.top"><i class="fa fa-home" aria-hidden="true"></i></a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="http://blog.flywithme.toppost/" itemprop="url"><span itemprop="title">post</span></a></li>
        
        <li class="active">Go: 10-1 channel</li>
      </ol>
    </nav>

    <article class="single">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2018-03-04T19:59:50JST">Mar 4, 2018</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="http://blog.flywithme.toppost/">post</a></li>
      
    </ul>

    <h1 class="title">Go: 10-1 channel</h1>
  </header>

  

  <div class="article-body">

<h5 id="channel的用法">channel的用法</h5>

<ul>
<li>channel</li>
<li>buffered channel</li>
<li>range</li>
<li>理论基础：Communication Sequential Process(CSP)</li>
<li>Don&rsquo;t communicate by sharing memory;share memory by communicating(不要通过共享内存来通信，
通过通信来共享内存)</li>
</ul>

<pre><code>package main

import (
	&quot;fmt&quot;
	&quot;time&quot;
)

func worker(id int, c chan int) {
	for n := range c {
		fmt.Printf(&quot;Worker %d received %c\n&quot;,
			id, n)
	}
}

func createWorker(id int) chan&lt;- int {
	c := make(chan int)
	go worker(id, c)
	return c
}

func chanDemo() {
	var channels [10]chan&lt;- int
	for i := 0; i &lt; 10; i++ {
		channels[i] = createWorker(i)
	}

	for i := 0; i &lt; 10; i++ {
		channels[i] &lt;- 'a' + i
	}

	for i := 0; i &lt; 10; i++ {
		channels[i] &lt;- 'A' + i
	}

	time.Sleep(time.Millisecond)
}

func bufferedChannel() {
	c := make(chan int, 3)
	go worker(0, c)
	c &lt;- 'a'
	c &lt;- 'b'
	c &lt;- 'c'
	c &lt;- 'd'
	time.Sleep(time.Millisecond)
}

func channelClose() {
	c := make(chan int)
	go worker(0, c)
	c &lt;- 'a'
	c &lt;- 'b'
	c &lt;- 'c'
	c &lt;- 'd'
	close(c)
	time.Sleep(time.Millisecond)
}

func main() {
	fmt.Println(&quot;Channel as first-class citizen&quot;)
	chanDemo()
	fmt.Println(&quot;Buffered channel&quot;)
	bufferedChannel()
	fmt.Println(&quot;Channel close and range&quot;)
	channelClose()
}
</code></pre>

<h5 id="示例-使用channel来等待goroutine-结束-waitgroup的使用">示例： 使用channel来等待goroutine 结束 （waitGroup的使用）</h5>

<pre><code>package main

import (
	&quot;fmt&quot;
	&quot;sync&quot;
)

func doWork(id int,
	w worker) {
	for n := range w.in {
		fmt.Printf(&quot;Worker %d received %c\n&quot;,
			id, n)
		w.done()
	}
}

type worker struct {
	in   chan int
	done func()
}

func createWorker(
	id int, wg *sync.WaitGroup) worker {
	w := worker{
		in: make(chan int),
		done: func() {
			wg.Done()
		},
	}
	go doWork(id, w)
	return w
}

func chanDemo() {
	var wg sync.WaitGroup

	var workers [10]worker
	for i := 0; i &lt; 10; i++ {
		workers[i] = createWorker(i, &amp;wg)
	}

	wg.Add(20)
	for i, worker := range workers {
		worker.in &lt;- 'a' + i
	}
	for i, worker := range workers {
		worker.in &lt;- 'A' + i
	}

	wg.Wait()
}

func main() {
	chanDemo()
}

</code></pre>

<h5 id="示例二-使用channel来实现叔的遍历">示例二：使用channel来实现叔的遍历</h5>

<pre><code> 
func (node *Node) TraverseFunc(f func(*Node)) {
	if node == nil {
		return
	}

	node.Left.TraverseFunc(f)
	f(node)
	node.Right.TraverseFunc(f)
}

func (node *Node) TraverseWithChannel() chan *Node {
	out := make(chan *Node)
	go func() {
		node.TraverseFunc(func(node *Node) {
			out &lt;- node
		})
		close(out)
	}()
	return out
}


---------------------
	c := root.TraverseWithChannel()
	maxValue := 0
	for node := range c {
		if node.Value &gt; maxValue {
			maxValue = node.Value
		}
	}

</code></pre>

<h5 id="示例三-使用select来进行调度">示例三：使用Select来进行调度</h5>

<ul>
<li>Select 的使用</li>
<li>定时器的使用</li>
<li>在select中可以使用Nil channel</li>
</ul>

<pre><code>package main

import (
	&quot;fmt&quot;
	&quot;math/rand&quot;
	&quot;time&quot;
)

func generator() chan int {
	out := make(chan int)
	go func() {
		i := 0
		for {
			time.Sleep(
				time.Duration(rand.Intn(1500)) *
					time.Millisecond)
			out &lt;- i
			i++
		}
	}()
	return out
}

func worker(id int, c chan int) {
	for n := range c {
		time.Sleep(time.Second)
		fmt.Printf(&quot;Worker %d received %d\n&quot;,
			id, n)
	}
}

func createWorker(id int) chan&lt;- int {
	c := make(chan int)
	go worker(id, c)
	return c
}

func main() {
	var c1, c2 = generator(), generator()
	var worker = createWorker(0)

	var values []int
	tm := time.After(10 * time.Second)
	tick := time.Tick(time.Second)
	for {
		var activeWorker chan&lt;- int
		var activeValue int
		if len(values) &gt; 0 {
			activeWorker = worker
			activeValue = values[0]
		}

		select {
		case n := &lt;-c1:
			values = append(values, n)
		case n := &lt;-c2:
			values = append(values, n)
		case activeWorker &lt;- activeValue:
			values = values[1:]

		case &lt;-time.After(800 * time.Millisecond):
			fmt.Println(&quot;timeout&quot;)
		case &lt;-tick:
			fmt.Println(
				&quot;queue len =&quot;, len(values))
		case &lt;-tm:
			fmt.Println(&quot;bye&quot;)
			return
		}
	}
}

</code></pre>
</div>

  <footer class="article-footer">
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">CATEGORIES</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="http://blog.flywithme.topcategories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></li>
          
          <li><a href="http://blog.flywithme.topcategories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/">技术文章</a></li>
          
        </ul>
      </div>
    </section>
    
    
    
    
  </footer>

</article>


    
  </div>

  <div class="col-md-4">
    
<aside class="l-sidebar">

  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">LATESTS</div>
    </div>
    <div class="list-group">
      
      <a href="http://blog.flywithme.top/2019/02/24/gobin/" class="list-group-item">go bin执行问题记录</a>
      
      <a href="http://blog.flywithme.top/2019/01/15/nginx/" class="list-group-item">Nginx 配置 HTTPS 服务器</a>
      
      <a href="http://blog.flywithme.top/2019/01/13/mongodump/" class="list-group-item">mongodb 维护小记</a>
      
      <a href="http://blog.flywithme.top/2018/12/24/vue_webserver/" class="list-group-item">Vue上线后，history页面点击刷新按钮报错404问题</a>
      
      <a href="http://blog.flywithme.top/2018/12/24/vue-element02/" class="list-group-item">vue 路由重载之后导致history页面刷新空白问题fix</a>
      
      <a href="http://blog.flywithme.top/2018/12/22/vue-element-admin01/" class="list-group-item">vue-element-admin 踩坑日记 01</a>
      
      <a href="http://blog.flywithme.top/2018/12/18/blocked-by-cors-policy/" class="list-group-item">gin api 跨域问题,cors</a>
      
      <a href="http://blog.flywithme.top/2018/12/10/mongodb/" class="list-group-item">MongoDB 用户名密码登录</a>
      
      <a href="http://blog.flywithme.top/2018/08/31/nat/" class="list-group-item">nat</a>
      
      <a href="http://blog.flywithme.top/2018/04/02/note_28/" class="list-group-item">Elasticsearch 入门</a>
      
    </div>
  </section>

  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">CATEGORY</div>
    </div>
    <div class="list-group">
      
      <a href="http://blog.flywithme.topcategories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0" class="list-group-item">技术文章</a>
      
      <a href="http://blog.flywithme.topcategories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0" class="list-group-item">学习笔记</a>
      
      <a href="http://blog.flywithme.topcategories/%E6%80%9D%E8%80%83%E6%84%9F%E6%82%9F" class="list-group-item">思考感悟</a>
      
      <a href="http://blog.flywithme.topcategories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0" class="list-group-item">读书笔记</a>
      
    </div>
  </section>
  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">TAG</div>
    </div>
    <div class="list-group">
      
    </div>
  </section>
  

</aside>


  </div>
</div>

      </div>
    </main>

    <footer class="l-footer">
      <div class="container">
        <p><span class="h-logo">&copy; Fly With Bug</span></p>
        <aside>
          <p>Powered by <a href="https://gohugo.io/">Hugo</a>.</p>
          <p><a href="https://github.com/dim0627/hugo_theme_beg">Beg</a> designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>.</p>
        </aside>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

